#!/usr/bin/env php
<?php

declare(strict_types=1);

use phpDocumentor\Guides\Console\Application;
use phpDocumentor\Guides\Console\DependencyInjection\ApplicationExtension;
use Symfony\Component\Config\FileLocator;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\Loader\YamlFileLoader;

require_once dirname(__DIR__) . '/vendor/autoload_runtime.php';

return function (array $context) {
    $container = new ContainerBuilder();

    // Load manual parameters
    $container->setParameter('vendor_dir', __DIR__ . '/../vendor');
    $container->setParameter('application_directory', __DIR__);
    $container->setParameter('working_directory', rtrim(getcwd(), '/'));

    // Load container configuration
    $loader = new YamlFileLoader($container, new FileLocator());
    $loader->load(__DIR__.'/../resources/config/services.yml');
    $container->registerExtension(new ApplicationExtension());
    $container->loadFromExtension('application');

    // Compile container
    $container->compile();

    return $container->get(Application::class);
};
